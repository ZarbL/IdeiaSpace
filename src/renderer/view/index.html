<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ideia Space Mission</title>
  <link rel="stylesheet" href="./style.css">
  <script src="../../../node_modules/blockly/blockly_compressed.js"></script>
  <script src="../../../node_modules/blockly/blocks_compressed.js"></script>
  <script src="../../../node_modules/blockly/javascript_compressed.js"></script>
  <script src="../../../node_modules/blockly/msg/en.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executar Blocos</title>
</head>
<body>
  <header class="header">
    <img src="../../assets/logo.png" class="logo" alt="Logo Ideia">
    <h1>Mission Programming Tool</h1>
    <button id="darkModeToggle" class="dark-mode-toggle tooltip" data-tooltip="Alternar tema escuro">
      üåô
    </button>
  </header>
  <div class="container">
    <div id="blocklyDiv" class="blockly-area"></div>
    <div class="side-panel">
      <div class="code-header">
        <h3>üß† C√≥digo C++</h3>
      </div>
      <pre id="code-display" class="code-box">// C√≥digo C++ aparecer√° aqui automaticamente</pre>
      <div class="monitor-section">
        <div class="button-group">
          <button id="startButton" class="icon-button tooltip" data-tooltip="Executar c√≥digo">
            ‚ñ∂
          </button>
          <button id="copyButton" class="icon-button tooltip" data-tooltip="Copiar c√≥digo">
            ‚ßâ
          </button>
        </div>
        <div class="copy-feedback" id="copyFeedback">C√≥digo copiado para a √°rea de transfer√™ncia!</div>
        <p id="message"></p>
      </div>
    </div>
  </div>

  <!-- Modal para criar vari√°veis -->
  <div id="variable-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>üöÄ Criar Nova Vari√°vel</h2>
      <div class="modal-body">
        <label for="variable-name">Nome da vari√°vel:</label>
        <input type="text" id="variable-name" placeholder="Digite o nome da vari√°vel..." maxlength="50">
        <div class="modal-buttons">
          <button id="create-variable-btn" class="btn-primary variable-create">‚úÖ Criar</button>
          <button id="cancel-variable-btn" class="btn-secondary">‚ùå Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <xml id="toolbox" class="toolbox">
    <category name="L√≥gica" colour="#1d1856">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_boolean"></block>
    </category>
    <category name="Controle" colour="#00cfe5">
      <block type="arduino_setup"></block>
      <block type="arduino_loop"></block>
      <block type="void_display"></block>
      <sep></sep>
      <block type="arduino_serial_begin"></block>
      <block type="serial_not"></block>
      <sep></sep>
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number"><field name="NUM">10</field></shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
    </category>
    <category name="Matem√°tica" colour="#e80074">
      <block type="math_number"><field name="NUM">0</field></block>
      <block type="math_arithmetic"></block>
      <block type="math_boolean"></block>
    </category>
    <category name="Texto" colour="#5C7CFA">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">Ol√°, mundo!</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Vari√°veis" colour="#00cfe5">
      <button text="‚ûï Criar Nova Vari√°vel" callbackKey="CREATE_VARIABLE"></button>
    </category>
    <category name="Listas" colour="#00cfe5">
      <block type="variable_declaration">
        <value name="VALUE">
          <shadow type="math_number"><field name="NUM">0</field></shadow>
        </value>
      </block>
    </category>
    <category name="Fun√ß√µes" colour="#e80074" custom="PROCEDURE">
    </category>
    <category name="Tempo" colour="#e80074">
      <block type="delay_function">
        <value name="DELAY_TIME">
          <shadow type="math_number">
            <field name="NUM">1000</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Bibliotecas" colour="#3c3c3c">
      <block type="library_arduino_basic"></block>
      <sep></sep>
      <block type="library_wire"></block>
      <sep></sep>
      <block type="library_sensor"></block>
      <block type="library_bmp180"></block>
      <block type="library_bh1750"></block>
      <block type="library_hmc5883"></block>
      <block type="library_mpu6050"></block>
      <block type="library_dht"></block>
    </category>
    <category name="Sensores" colour="#0c0931">
      <category name="MPU6050" colour="#2e2e8a">
        <block type="mpu6050_init"></block>
        <sep></sep>
        <block type="mpu6050_set_accel_range"></block>
        <block type="mpu6050_set_gyro_range"></block>
        <block type="mpu6050_set_filter_bandwidth"></block>
        <sep></sep>
        <block type="mpu6050_sensors_event"></block>
        <block type="mpu6050_get_event"></block>
        <sep></sep>
        <block type="mpu6050_accel_x"></block>
        <block type="mpu6050_accel_y"></block>
        <block type="mpu6050_accel_z"></block>
        <sep></sep>
        <block type="mpu6050_gyro_x"></block>
        <block type="mpu6050_gyro_y"></block>
        <block type="mpu6050_gyro_z"></block>
        <sep></sep>
        <block type="mpu6050_read"></block>
        <sep></sep>
        <block type="mpu6050_not"></block>
      </category>
      <category name="BMP180" colour="#8a2e2e">
        <block type="bmp180_init"></block>
        <sep></sep>
        <block type="bmp180_temperature"></block>
        <block type="bmp180_pressure"></block>
        <block type="bmp180_altitude"></block>
      </category>
      <category name="BH1750" colour="#ffcc00">
        <block type="bh1750_init"></block>
        <block type="bh1750_begin"></block>
        <sep></sep>
        <block type="bh1750_set_mode"></block>
        <sep></sep>
        <block type="bh1750_light_level"></block>
      </category>
      <category name="HMC5883" colour="#8a2e8a">
        <!-- Inicializa√ß√£o e configura√ß√£o -->
        <block type="hmc5883_sensor_object"></block>
        <block type="hmc5883_init"></block>
        <block type="hmc5883_begin"></block>
        <block type="hmc5883_set_gain"></block>
        <sep></sep>
        <!-- Leitura de dados -->
        <block type="hmc5883_event_declare"></block>
        <block type="hmc5883_get_event"></block>
        <sep></sep>
        <!-- Campo magn√©tico em cada eixo -->
        <block type="hmc5883_mag_x"></block>
        <block type="hmc5883_mag_y"></block>
        <block type="hmc5883_mag_z"></block>
        <sep></sep>
        <!-- C√°lculos avan√ßados -->
        <block type="hmc5883_field_strength"></block>
        <block type="hmc5883_heading"></block>
        <block type="hmc5883_direction_text">
          <value name="HEADING">
            <block type="hmc5883_heading"></block>
          </value>
        </block>
        <sep></sep>
        <!-- Corre√ß√£o de declina√ß√£o magn√©tica -->
        <block type="hmc5883_declination"></block>
      </category>
      <category name="DHT" colour="#2e8a2e">
        <block type="dht_init"></block>
        <block type="dht_begin"></block>
        <sep></sep>
        <block type="dht_temperature"></block>
        <block type="dht_humidity"></block>
        <block type="dht_heat_index">
        </block>
      </category>
    </category>
  </xml>

  <script src="../model/blocks.js"></script>
  <script src="../model/cpp_generator.js"></script>
  
  <script src="../controller/renderer.js"></script>
  <script src="../../../debug_delay_block.js"></script>
  <script>
    // Funcionalidade do bot√£o copiar
    document.addEventListener('DOMContentLoaded', function() {
      const copyButton = document.getElementById('copyButton');
      const codeDisplay = document.getElementById('code-display');
      const copyFeedback = document.getElementById('copyFeedback');

      copyButton.addEventListener('click', function() {
        // Pega o texto do c√≥digo
        const codeText = codeDisplay.textContent || codeDisplay.innerText;
        
        // Copia para a √°rea de transfer√™ncia
        navigator.clipboard.writeText(codeText).then(function() {
          // Mostra feedback de sucesso
          copyFeedback.classList.add('show');
          copyButton.setAttribute('data-tooltip', 'Copiado!');
          
          // Volta ao estado normal ap√≥s 2 segundos
          setTimeout(function() {
            copyFeedback.classList.remove('show');
            copyButton.setAttribute('data-tooltip', 'Copiar c√≥digo');
          }, 2000);
        }).catch(function(err) {
          // Fallback para navegadores mais antigos
          const textArea = document.createElement('textarea');
          textArea.value = codeText;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          
          // Mostra feedback
          copyFeedback.classList.add('show');
          copyButton.setAttribute('data-tooltip', 'Copiado!');
          
          setTimeout(function() {
            copyFeedback.classList.remove('show');
            copyButton.setAttribute('data-tooltip', 'Copiar c√≥digo');
          }, 2000);
        });
      });
    });

    // Funcionalidade do dark mode
    const darkModeToggle = document.getElementById('darkModeToggle');
    const body = document.body;

    // Verificar se h√° prefer√™ncia salva
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      body.classList.add('dark-mode');
      darkModeToggle.textContent = '‚òÄÔ∏è';
      darkModeToggle.setAttribute('data-tooltip', 'Alternar tema claro');
    }

    darkModeToggle.addEventListener('click', function() {
      body.classList.toggle('dark-mode');
      
      if (body.classList.contains('dark-mode')) {
        darkModeToggle.textContent = '‚òÄÔ∏è';
        darkModeToggle.setAttribute('data-tooltip', 'Alternar tema claro');
        localStorage.setItem('theme', 'dark');
      } else {
        darkModeToggle.textContent = 'üåô';
        darkModeToggle.setAttribute('data-tooltip', 'Alternar tema escuro');
        localStorage.setItem('theme', 'light');
      }
    });

    // Funcionalidade do modal de vari√°veis
    const variableModal = document.getElementById('variable-modal');
    const createVariableBtn = document.getElementById('create-variable-btn');
    const cancelVariableBtn = document.getElementById('cancel-variable-btn');
    const closeModalSpan = document.getElementsByClassName('close')[0];

    // Quando o usu√°rio clica no bot√£o de criar nova vari√°vel
    document.querySelector('button[callbackKey="CREATE_VARIABLE"]').addEventListener('click', function() {
      variableModal.style.display = 'block';
    });

    // Quando o usu√°rio clica no bot√£o de criar vari√°vel no modal
    createVariableBtn.addEventListener('click', function() {
      const variableName = document.getElementById('variable-name').value.trim();
      
      if (variableName) {
        // Fecha o modal
        variableModal.style.display = 'none';
        
        // Limpa o campo de entrada
        document.getElementById('variable-name').value = '';
      } else {
        alert('Por favor, digite um nome v√°lido para a vari√°vel.');
      }
    });

    // Quando o usu√°rio clica no bot√£o de cancelar no modal
    cancelVariableBtn.addEventListener('click', function() {
      variableModal.style.display = 'none';
    });

    // Quando o usu√°rio clica no "x" para fechar o modal
    closeModalSpan.addEventListener('click', function() {
      variableModal.style.display = 'none';
    });

    // Fecha o modal se o usu√°rio clicar fora dele
    window.addEventListener('click', function(event) {
      if (event.target == variableModal) {
        variableModal.style.display = 'none';
      }
    });
  </script>
</body>
</html>
